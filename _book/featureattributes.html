<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spatial Data Science with R</title>
  <meta name="description" content="description_xx">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Spatial Data Science with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="description_xx" />
  <meta name="github-repo" content="edzer/sdsr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spatial Data Science with R" />
  
  <meta name="twitter:description" content="description_xx" />
  

<meta name="author" content="Edzer Pebesma, Roger Bivand">


<meta name="date" content="2018-05-17">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="geommanip.html">
<link rel="next" href="rs.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.0/leaflet-providers-plugin.js"></script>
<script src="libs/mapPane-0.0.1/map-pane.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/PopupTable-0.0.1/popup.css" rel="stylesheet" />


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Data Science with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Spatial Data</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-first-map"><i class="fa fa-check"></i><b>1.1</b> A first map</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#reading"><i class="fa fa-check"></i><b>1.2</b> Reading and writing</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="coordinate-systems.html"><a href="coordinate-systems.html"><i class="fa fa-check"></i><b>2</b> Coordinate systems</a><ul>
<li class="chapter" data-level="2.1" data-path="coordinate-systems.html"><a href="coordinate-systems.html#cartesian-and-polar-coordinates"><i class="fa fa-check"></i><b>2.1</b> Cartesian and polar coordinates</a></li>
<li class="chapter" data-level="2.2" data-path="coordinate-systems.html"><a href="coordinate-systems.html#spherical-and-ellipsoidal-coordinates"><i class="fa fa-check"></i><b>2.2</b> Spherical and ellipsoidal coordinates</a></li>
<li class="chapter" data-level="2.3" data-path="coordinate-systems.html"><a href="coordinate-systems.html#distances"><i class="fa fa-check"></i><b>2.3</b> Distances</a></li>
<li class="chapter" data-level="2.4" data-path="coordinate-systems.html"><a href="coordinate-systems.html#bounded-spaces"><i class="fa fa-check"></i><b>2.4</b> Bounded spaces</a></li>
<li class="chapter" data-level="2.5" data-path="coordinate-systems.html"><a href="coordinate-systems.html#time"><i class="fa fa-check"></i><b>2.5</b> Time</a></li>
<li class="chapter" data-level="2.6" data-path="coordinate-systems.html"><a href="coordinate-systems.html#exercises-1"><i class="fa fa-check"></i><b>2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="geometries.html"><a href="geometries.html"><i class="fa fa-check"></i><b>3</b> Geometries</a><ul>
<li class="chapter" data-level="3.1" data-path="geometries.html"><a href="geometries.html#simple-feature-geometries"><i class="fa fa-check"></i><b>3.1</b> Simple feature geometries</a></li>
<li class="chapter" data-level="3.2" data-path="geometries.html"><a href="geometries.html#sfc-simple-feature-geometry-list-columns"><i class="fa fa-check"></i><b>3.2</b> <code>sfc</code>: Simple feature geometry list-columns</a></li>
<li class="chapter" data-level="3.3" data-path="geometries.html"><a href="geometries.html#geometries-on-the-spheroid"><i class="fa fa-check"></i><b>3.3</b> Geometries on the spheroid</a></li>
<li class="chapter" data-level="3.4" data-path="geometries.html"><a href="geometries.html#other-geometries"><i class="fa fa-check"></i><b>3.4</b> Other geometries</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vectorraster.html"><a href="vectorraster.html"><i class="fa fa-check"></i><b>4</b> Vector/Raster</a></li>
<li class="chapter" data-level="5" data-path="geommanip.html"><a href="geommanip.html"><i class="fa fa-check"></i><b>5</b> Geometric Manipulations</a><ul>
<li class="chapter" data-level="5.1" data-path="geommanip.html"><a href="geommanip.html#unary-operations"><i class="fa fa-check"></i><b>5.1</b> Unary Operations</a></li>
<li class="chapter" data-level="5.2" data-path="geommanip.html"><a href="geommanip.html#binary-operations"><i class="fa fa-check"></i><b>5.2</b> Binary Operations</a></li>
<li class="chapter" data-level="5.3" data-path="geommanip.html"><a href="geommanip.html#n-ary-operations"><i class="fa fa-check"></i><b>5.3</b> N-ary Operations</a></li>
<li class="chapter" data-level="5.4" data-path="geommanip.html"><a href="geommanip.html#precision"><i class="fa fa-check"></i><b>5.4</b> Precision</a></li>
<li class="chapter" data-level="5.5" data-path="geommanip.html"><a href="geommanip.html#warnings-for-longitudelatitude-geometries"><i class="fa fa-check"></i><b>5.5</b> Warnings for longitude/latitude geometries</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="featureattributes.html"><a href="featureattributes.html"><i class="fa fa-check"></i><b>6</b> Feature attributes</a><ul>
<li class="chapter" data-level="6.1" data-path="featureattributes.html"><a href="featureattributes.html#agr"><i class="fa fa-check"></i><b>6.1</b> Attribute-geometry relationship</a></li>
<li class="chapter" data-level="6.2" data-path="featureattributes.html"><a href="featureattributes.html#spatial-join"><i class="fa fa-check"></i><b>6.2</b> Spatial join</a></li>
<li class="chapter" data-level="6.3" data-path="featureattributes.html"><a href="featureattributes.html#aggregate-and-summarise"><i class="fa fa-check"></i><b>6.3</b> Aggregate and summarise</a></li>
<li class="chapter" data-level="6.4" data-path="featureattributes.html"><a href="featureattributes.html#intersections"><i class="fa fa-check"></i><b>6.4</b> Intersections</a></li>
<li class="chapter" data-level="6.5" data-path="featureattributes.html"><a href="featureattributes.html#area-weighted-interpolation"><i class="fa fa-check"></i><b>6.5</b> Area-weighted interpolation</a></li>
<li class="chapter" data-level="6.6" data-path="featureattributes.html"><a href="featureattributes.html#exercises-2"><i class="fa fa-check"></i><b>6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rs.html"><a href="rs.html"><i class="fa fa-check"></i><b>7</b> Reference Systems</a><ul>
<li class="chapter" data-level="7.1" data-path="rs.html"><a href="rs.html#units"><i class="fa fa-check"></i><b>7.1</b> Units of measurement</a></li>
<li class="chapter" data-level="7.2" data-path="rs.html"><a href="rs.html#crs"><i class="fa fa-check"></i><b>7.2</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="7.3" data-path="rs.html"><a href="rs.html#transform"><i class="fa fa-check"></i><b>7.3</b> Coordinate transformation and conversion</a></li>
</ul></li>
<li class="part"><span><b>II Maps</b></span></li>
<li class="chapter" data-level="8" data-path="plotting-spatial-data.html"><a href="plotting-spatial-data.html"><i class="fa fa-check"></i><b>8</b> Plotting spatial data</a></li>
<li class="chapter" data-level="9" data-path="plot.html"><a href="plot.html"><i class="fa fa-check"></i><b>9</b> Base Plot</a></li>
<li class="chapter" data-level="10" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>10</b> ggplot2</a></li>
<li class="chapter" data-level="11" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>11</b> Interactive Maps</a></li>
<li class="part"><span><b>III Spatial Analysis</b></span></li>
<li class="chapter" data-level="12" data-path="summarizing-geometries.html"><a href="summarizing-geometries.html"><i class="fa fa-check"></i><b>12</b> Summarizing Geometries</a></li>
<li class="chapter" data-level="13" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html"><i class="fa fa-check"></i><b>13</b> Point Pattern Analysis</a></li>
<li class="chapter" data-level="14" data-path="manipulating-attributes-summarise-aggregate-union-sample.html"><a href="manipulating-attributes-summarise-aggregate-union-sample.html"><i class="fa fa-check"></i><b>14</b> Manipulating attributes: summarise, aggregate, union, sample</a></li>
<li class="chapter" data-level="15" data-path="units-of-measure-revisited-attribute-units-intensive-and-extensive-variables.html"><a href="units-of-measure-revisited-attribute-units-intensive-and-extensive-variables.html"><i class="fa fa-check"></i><b>15</b> Units of measure revisited: attribute units, intensive and extensive variables</a></li>
<li class="chapter" data-level="16" data-path="up-and-downscaling.html"><a href="up-and-downscaling.html"><i class="fa fa-check"></i><b>16</b> Up- and Downscaling</a></li>
<li class="chapter" data-level="17" data-path="spatial-interpolation-and-geostatistics.html"><a href="spatial-interpolation-and-geostatistics.html"><i class="fa fa-check"></i><b>17</b> Spatial Interpolation and geostatistics</a></li>
<li class="chapter" data-level="18" data-path="area-data-and-spatial-correlation.html"><a href="area-data-and-spatial-correlation.html"><i class="fa fa-check"></i><b>18</b> Area Data and Spatial Correlation</a></li>
<li class="chapter" data-level="19" data-path="spatial-regression-and-autocorrelation.html"><a href="spatial-regression-and-autocorrelation.html"><i class="fa fa-check"></i><b>19</b> Spatial Regression and Autocorrelation</a></li>
<li class="chapter" data-level="20" data-path="raster-modelling.html"><a href="raster-modelling.html"><i class="fa fa-check"></i><b>20</b> Raster Modelling</a></li>
<li class="part"><span><b>IV Spatiotemporal Analysis</b></span></li>
<li class="chapter" data-level="21" data-path="array.html"><a href="array.html"><i class="fa fa-check"></i><b>21</b> Array data: raster and vector data cubes</a></li>
<li class="chapter" data-level="22" data-path="movement-data.html"><a href="movement-data.html"><i class="fa fa-check"></i><b>22</b> Movement data</a></li>
<li class="chapter" data-level="23" data-path="statistical-modelling-of-spatiotemporal-data.html"><a href="statistical-modelling-of-spatiotemporal-data.html"><i class="fa fa-check"></i><b>23</b> Statistical modelling of spatiotemporal data</a></li>
<li class="chapter" data-level="24" data-path="scalability.html"><a href="scalability.html"><i class="fa fa-check"></i><b>24</b> Scalability</a><ul>
<li class="chapter" data-level="24.1" data-path="scalability.html"><a href="scalability.html#out-of-memory"><i class="fa fa-check"></i><b>24.1</b> Out-of-memory</a></li>
<li class="chapter" data-level="24.2" data-path="scalability.html"><a href="scalability.html#out-of-core"><i class="fa fa-check"></i><b>24.2</b> Out-of-core</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-data-structures.html"><a href="r-data-structures.html"><i class="fa fa-check"></i>R data structures</a><ul>
<li class="chapter" data-level="24.3" data-path="r-data-structures.html"><a href="r-data-structures.html#homogeneous-vectors"><i class="fa fa-check"></i><b>24.3</b> Homogeneous vectors</a></li>
<li class="chapter" data-level="24.4" data-path="r-data-structures.html"><a href="r-data-structures.html#heterogeneous-vectors-list"><i class="fa fa-check"></i><b>24.4</b> Heterogeneous vectors: list</a></li>
<li class="chapter" data-level="24.5" data-path="r-data-structures.html"><a href="r-data-structures.html#attributes"><i class="fa fa-check"></i><b>24.5</b> Attributes</a></li>
<li class="chapter" data-level="24.6" data-path="r-data-structures.html"><a href="r-data-structures.html#various-names-attributes"><i class="fa fa-check"></i><b>24.6</b> various names attributes</a></li>
<li class="chapter" data-level="24.7" data-path="r-data-structures.html"><a href="r-data-structures.html#using-structure"><i class="fa fa-check"></i><b>24.7</b> using structure</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="featureattributes" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Feature attributes</h1>
<p>Feature <em>attributes</em> refer to the properties of features (“things”) that do not describe the feature’s geometry. Feature attributes can be <em>derived</em> from geometry (e.g. length of a <code>LINESTRING</code>, area of a <code>POLYGON</code>) but they can also refer to completely different properties, such as</p>
<ul>
<li>the name of a street or a county,</li>
<li>the number of people living in a country,</li>
<li>the type of a road</li>
<li>the soil type in a polygon from a soil map.</li>
<li>the opening hours of a shop</li>
</ul>
<p>Although we believe that temporal properties of features are at no less fundamental than their spatial properties, the simple feature access standard and consequently the <code>sf</code> package does not give time a similar role as space; more on that in chapter <a href="array.html#array">21</a>.</p>
<p>Most <code>sf</code> objects will contain both geometries and attributes for features. The geometric operations described in the previous chapter <a href="geommanip.html#geommanip">5</a> operate on geometries <em>only</em>. When applied to an object of class <code>sf</code>, all <em>unary operations</em> will, for functions returning</p>
<ul>
<li>a predicate or a measure, ignore all attributes</li>
<li>a geometr y, replace the object’s geometry.</li>
</ul>
<p>In all these cases, attribute <em>values</em> remain unmodified. At first sight, that looks rather harmless. But if we look into a simple case of replacing a county boundary with a county centroid, as in</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="kw">library</span>(dplyr)
<span class="kw">system.file</span>(<span class="st">&quot;gpkg/nc.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">read_sf</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_transform</span>(<span class="dv">32119</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(BIR74, SID74, NAME) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_centroid</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">1</span>)
<span class="co">#&gt; Warning in st_centroid.sf(.): st_centroid assumes attributes are constant</span>
<span class="co">#&gt; over geometries of x</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 386000 ymin: 3e+05 xmax: 386000 ymax: 3e+05</span>
<span class="co">#&gt; epsg (SRID):    32119</span>
<span class="co">#&gt; proj4string:    +proj=lcc +lat_1=36.16666666666666 +lat_2=34.33333333333334 +lat_0=33.75 +lon_0=-79 +x_0=609601.22 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</span>
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   BIR74 SID74 NAME            geom</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;POINT [m]&gt;</span>
<span class="co">#&gt; 1  1091     1 Ashe  (385605 3e+05)</span></code></pre></div>
<p>we receive a warning. This warning is justified for the first two variables shown (total births and number of SID disease cases, 1974) which, as such, are <em>not associated with</em> a feature whose geometry is <code>POINT (385605.4 300303.5)</code>. The third variable, <code>NAME</code> is however still the county name for the point indicated, but the point geometry no longer <em>is</em> the county geometry.</p>
<div id="agr" class="section level2">
<h2><span class="header-section-number">6.1</span> Attribute-geometry relationship</h2>
<p>Changing the feature geometry without changing the feature attributes does change the <em>feature</em>, since the feature is characterised by the combination of geometry and attributes. Can we, ahead of time, predict whether the resulting feature will still meaningfully relate to the attribute data when we for instance replaced all geometries with their convex hull or centroid? It depends.</p>
<p>Take the example of a road, represented by a <code>LINESTRING</code>, which has an attribute property road width equal to 10 m. What can we say about the road width of an arbitray subsectin of this road? That depends on whether the attribute road length describes, for instance the road width everywhere, meaning that road width is constant along the road, or whether it describes an aggregate property, such as minimum or average road width. In case of the minimum, for an arbitrary subsection of the road one could still argue that the minimum road with must be at least as large as the minimum road width for the whole segment, but it is no longer <em>the minimum</em> for that subsection. This gives us two “types” for the attribute-geometry relationship (AGR):</p>
<ul>
<li><strong>constant</strong> the attribute value is valid everywhere in or over the geometry</li>
<li><strong>aggregate</strong> the attribute is an aggregate, a summary value over the geometry</li>
</ul>
<p>For polygon data, typical examples of <strong>constant</strong> AGR are</p>
<ul>
<li>land use for a land use polygon</li>
<li>rock units or geologic strata in a geological map</li>
<li>soil type in a soil map</li>
<li>elevation class in a elevation map that shows elevation as classes</li>
<li>klimate zone in a climate zone map</li>
</ul>
<p>Typical examples for the <strong>aggregate</strong> AGR are</p>
<ul>
<li>population, either as number of persons or as population density</li>
<li>other socio-economic data, summarised by area</li>
<li>total emission of pollutants by region</li>
</ul>
<p>A third type of AGR is that where an attribute identifies a feature geometry. The example above is county <code>NAME</code>: the name identifies the county, and is still the county <code>NAME</code> for any sub-area.</p>
<ul>
<li><strong>identity</strong> the attribute value uniquely identifies the geometry, there are no other geometries with the same value</li>
</ul>
<p>Arbitrary sub-areas will lose the <strong>identity</strong> property but becomes a <strong>constant</strong> attribute. An example is:</p>
<ul>
<li>any point inside a county is still part of the county and must have the same value for county name, but it does not longer represent the (total) geometry of that county.</li>
</ul>
<p>We can specify the AGR of an attribute in an <code>sf</code> object by <code>st_set_agr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;gpkg/nc.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">read_sf</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_transform</span>(<span class="dv">32119</span>)
nc1 &lt;-<span class="st"> </span>nc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BIR74, SID74, NAME) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_set_agr</span>(<span class="kw">c</span>(<span class="dt">BIR74 =</span> <span class="st">&quot;aggregate&quot;</span>, <span class="dt">SID74 =</span> <span class="st">&quot;aggregate&quot;</span>, <span class="dt">NAME =</span> <span class="st">&quot;identity&quot;</span>))</code></pre></div>
<p>This helps to get rid of warnings that a particular attribute is assumed to be constant over a geometry, if it already is. The following no longer generates a warning</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(NAME) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_centroid</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">head</span>(<span class="dv">1</span>)
<span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span>
<span class="co">#&gt; Attribute-geometry relationship: 1 constant, 0 aggregate, 0 identity</span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 386000 ymin: 3e+05 xmax: 386000 ymax: 3e+05</span>
<span class="co">#&gt; epsg (SRID):    32119</span>
<span class="co">#&gt; proj4string:    +proj=lcc +lat_1=36.16666666666666 +lat_2=34.33333333333334 +lat_0=33.75 +lon_0=-79 +x_0=609601.22 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   NAME            geom</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;POINT [m]&gt;</span>
<span class="co">#&gt; 1 Ashe  (385605 3e+05)</span></code></pre></div>
<p>and also changes AGR for <code>NAME</code> from <code>identity</code> to <code>constant</code> when replacing the geometry with the geometry’s centroid:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(NAME) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_centroid</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">st_agr</span>()
<span class="co">#&gt;     NAME </span>
<span class="co">#&gt; constant </span>
<span class="co">#&gt; Levels: constant aggregate identity</span></code></pre></div>
</div>
<div id="spatial-join" class="section level2">
<h2><span class="header-section-number">6.2</span> Spatial join</h2>
</div>
<div id="aggregate-and-summarise" class="section level2">
<h2><span class="header-section-number">6.3</span> Aggregate and summarise</h2>
</div>
<div id="intersections" class="section level2">
<h2><span class="header-section-number">6.4</span> Intersections</h2>
<p>Suppose we have two datasets with different geometries and attributes, and we want to compute their intersections:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 =<span class="st"> </span><span class="kw">st_polygon</span>(<span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))))
d1 =<span class="st"> </span><span class="kw">st_sf</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>), <span class="dt">geom =</span> <span class="kw">st_sfc</span>(p1, p1 <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">0</span>)))
d2 =<span class="st"> </span><span class="kw">st_sf</span>(<span class="dt">b =</span> <span class="kw">c</span>(<span class="dv">4</span>), <span class="dt">geom =</span> <span class="kw">st_sfc</span>(p1 <span class="op">*</span><span class="st"> </span><span class="fl">.75</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)))
<span class="kw">plot</span>(d1, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">8</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="dv">1</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>)
<span class="kw">plot</span>(d2, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="sdsr_files/figure-html/unnamed-chunk-58-1.png" width="672" style="display: block; margin: auto;" /> What will the intersection of these two objects give?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">i =</span> <span class="kw">st_intersection</span>(d1, d2))
<span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant</span>
<span class="co">#&gt; throughout all geometries</span>
<span class="co">#&gt; Simple feature collection with 2 features and 2 fields</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 3 ymin: 2 xmax: 6 ymax: 4</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    NA</span>
<span class="co">#&gt;   a b                           geom</span>
<span class="co">#&gt; 1 3 4 POLYGON ((3 4, 4 4, 4 2, 3 ...</span>
<span class="co">#&gt; 2 1 4 POLYGON ((4 2, 4 4, 6 4, 6 ...</span>
<span class="kw">plot</span>(d1, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">8</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>)
<span class="kw">plot</span>(d2, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(i), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="kw">c</span>(.<span class="dv">7</span>,.<span class="dv">9</span>)), , <span class="dt">border =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">lwd =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="sdsr_files/figure-html/unnamed-chunk-59-1.png" width="672" style="display: block; margin: auto;" /> It gives the areas of intersection, along with the corresponding attributes of both objects, and a warning that attributes were assumed to be spatially constant.</p>
</div>
<div id="area-weighted-interpolation" class="section level2">
<h2><span class="header-section-number">6.5</span> Area-weighted interpolation</h2>
<p>Suppose we want to combine geometries and attributes of two datasets such, that we get attribute values of the first datasets summarised for the geometries of the second. There are various ways we can go for this. The simples one, building on the previous example, would be to obtain for the geometry of <code>d2</code> the attribute of <code>d1</code> that has the largest overlap with <code>d2</code>. This is obtained by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_join</span>(d2, d1, <span class="dt">largest =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant</span>
<span class="co">#&gt; throughout all geometries</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 3 ymin: 2 xmax: 6 ymax: 5</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    NA</span>
<span class="co">#&gt;   b a                           geom</span>
<span class="co">#&gt; 1 4 1 POLYGON ((3 2, 6 2, 6 5, 3 ...</span></code></pre></div>
<p>Another option would be to summarise the attribute, e.g. taking its mean, regardless the amount of overlap. This is obtained by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggregate</span>(d1, d2, mean)
<span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 3 ymin: 2 xmax: 6 ymax: 5</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    NA</span>
<span class="co">#&gt;   a                       geometry</span>
<span class="co">#&gt; 1 2 POLYGON ((3 2, 6 2, 6 5, 3 ...</span></code></pre></div>
<p>A third option is to apply area-weighted interpolation, meaning that we interpolate (average) the variable by taking into account the respective area contributions of overlap. This is done e.g. by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d3 =<span class="st"> </span><span class="kw">st_sfc</span>(p1 <span class="op">*</span><span class="st"> </span><span class="fl">.75</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>), p1 <span class="op">*</span><span class="st"> </span><span class="fl">.75</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))
<span class="kw">st_interpolate_aw</span>(d1, d3, <span class="dt">extensive =</span> <span class="ot">FALSE</span>)<span class="op">$</span>a
<span class="co">#&gt; Warning in st_interpolate_aw(d1, d3, extensive = FALSE): st_interpolate_aw</span>
<span class="co">#&gt; assumes attributes are constant over areas of x</span>
<span class="co">#&gt; [1] 1.67 1.67</span>
<span class="kw">st_interpolate_aw</span>(d1, d3, <span class="dt">extensive =</span> <span class="ot">TRUE</span>)<span class="op">$</span>a
<span class="co">#&gt; Warning in st_interpolate_aw(d1, d3, extensive = TRUE): st_interpolate_aw</span>
<span class="co">#&gt; assumes attributes are constant over areas of x</span>
<span class="co">#&gt; [1] 0.625 0.312</span></code></pre></div>
<div id="spatially-intensive-and-extensive-variables" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Spatially intensive and extensive variables</h3>
<p>The difference between the two examples for area-weighted interpolation is how the final weighted sum (value times area of intersection) is normalised: by the target area (extensive), or by the sum of the area covered (intensive, <code>extensive = FALSE</code>). Spatially intensive variables are variables for which the value, when we split an area, does not <em>principally</em> change. An example might be temperature, elevation, or population density. Spatially extensive variables are variables for which the value is also split, according to the area. Examples are population (amount), or area.</p>
</div>
</div>
<div id="exercises-2" class="section level2">
<h2><span class="header-section-number">6.6</span> Exercises</h2>
<ul>
<li>Add a variable to the <code>nc</code> dataset by <code>nc$State = &quot;North Carolina&quot;</code>. Which value should you attach to this variable for the attribute-geometry relationship (agr)?</li>
<li>Create a new <code>sf</code> object from the geometry obtained by <code>st_union(nc)</code>, and assign <code>&quot;North Carolina&quot;</code> to the variable <code>State</code>. Which <code>agr</code> can you now assign to this attribute variable?</li>
<li>Use <code>st_area</code> to add a variable with name <code>area</code> to <code>nc</code>. Compare the <code>area</code> and <code>AREA</code> variables in the <code>nc</code> dataset. What are the units of <code>AREA</code>? Are the two linearly related? If there are discrepancies, what could be the cause?</li>
<li>Is the <code>area</code> variable intensive or extensive? Is its agr equal to <code>constant</code>, <code>identity</code> or <code>aggregate</code>?</li>
<li>Find the name of the county that contains <code>POINT(-78.34046 35.017)</code></li>
<li>Find the names of all counties with boundaries that touch county <code>Sampson</code>.</li>
<li>List the names of all counties that are less than 50 km away from county <code>Sampson</code>.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="geommanip.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/edzer/sdsr/edit/master/06-Attributes.Rmd",
"text": "Edit"
},
"download": ["sdsr.pdf", "sdsr.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
